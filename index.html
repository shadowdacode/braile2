<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Identificador de Braile via IA</title>
<style>
body{background:#111;color:#eee;font-family:sans-serif;text-align:center;margin:0}
#controls{padding:10px;background:#222;display:flex;gap:10px;justify-content:center;align-items:center}
video{max-width:100%;height:auto}
</style>
</head>
<body>
<div id="controls">
<select id="cams"></select>
<button id="start">Iniciar</button>
<input id="key" placeholder="API Key" type="password" style="width:12em">
<button id="snap">Identificar</button>
</div>
<video id="vid" playsinline muted></video>
<div>Letra: <span id="ltr">?</span></div>
<script>
let stream;
const cams=document.getElementById('cams');
const startBtn=document.getElementById('start');
const snapBtn=document.getElementById('snap');
const video=document.getElementById('vid');
const apiKey=document.getElementById('key');
const ltr=document.getElementById('ltr');
async function listCams(){const devs=await navigator.mediaDevices.enumerateDevices();
  cams.innerHTML='';
  devs.filter(d=>d.kind==='videoinput').forEach((d,i)=>{
    const o=document.createElement('option');o.value=d.deviceId;o.text=d.label||`camera ${i+1}`;cams.appendChild(o);});}
async function start(){if(stream)stream.getTracks().forEach(t=>t.stop());
  const id=cams.value;stream=await navigator.mediaDevices.getUserMedia({video:{deviceId:id?{exact:id}:undefined}});
  video.srcObject=stream;video.play();}
async function identify(){if(!stream)return;const c=document.createElement('canvas');c.width=video.videoWidth;c.height=video.videoHeight;c.getContext('2d').drawImage(video,0,0);const base64=c.toDataURL('image/png').split(',')[1];try{
    const res=await fetch('https://api.openai.com/v1/chat/completions',{method:'POST',headers:{'Content-Type':'application/json','Authorization':'Bearer '+apiKey.value},body:JSON.stringify({model:'gpt-4-vision-preview',messages:[{role:'user',content:[{type:'text',text:'Qual letra em braile aparece na imagem?'},{type:'image_url',image_url:{content:`data:image/png;base64,${base64}`}}]}],max_tokens:5})});
    const data=await res.json();const ch=data.choices?.[0]?.message?.content?.trim()||'?';ltr.textContent=ch;speechSynthesis.cancel();speechSynthesis.speak(new SpeechSynthesisUtterance(ch));
  }catch(e){ltr.textContent='erro';}}
listCams();
startBtn.onclick=start;
snapBtn.onclick=identify;
</script>
</body>
</html>
